<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">
  <xacro:include filename="$(find za_description)/urdf/utils.xacro"/>"
  
  <xacro:macro name="za_macro" params="prefix">
    <!-- Is the robot being simulated in gazebo?" -->
    <xacro:arg name="gazebo" default="false" />

    <!-- link list -->
    <link name="${prefix}base_link">
      <visual>
        <geometry>
          <mesh filename="package://za_description/meshes/visual/base_link.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://za_description/meshes/collision/base_link_collision.stl"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="-0.01236763 -0.00120116 0.13466856"/>
        <mass value="18.32700000"/>
        <inertia ixx="0.16366788" ixy="-0.00000166" ixz="-0.00348810" iyy="0.22044850" iyz="0.00000286" izz="0.17770306"/>
      </inertial>
    </link>

    <link name="${prefix}link_1">
      <visual>
        <geometry>
          <mesh filename="package://za_description/meshes/visual/link_1.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://za_description/meshes/collision/link_1_collision.stl"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="0.01021395 0.00697465 -0.07935107"/>
        <mass value="13.44000000"/>
        <inertia ixx="0.13591253" ixy="0.00009739" ixz="-0.00604284" iyy="0.11223931" iyz="0.00027520" izz="0.10172556"/>
      </inertial>
    </link>

    <link name="${prefix}link_2">
      <visual>
        <geometry>
          <mesh filename="package://za_description/meshes/visual/link_2.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://za_description/meshes/collision/link_2_collision.stl"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="-0.00387549 -0.00718854 0.27138897"/>
        <mass value="17.11000000"/>
        <inertia ixx="0.52527032" ixy="0.00015072" ixz="0.00040686" iyy="0.50042448" iyz="0.00016892" izz="0.09140527"/>
      </inertial>
    </link>

    <link name="${prefix}link_3">
      <visual>
        <geometry>
          <mesh filename="package://za_description/meshes/visual/link_3.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://za_description/meshes/collision/link_3_collision.stl"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="0.02825936 0.00083544 -0.00574226"/>
        <mass value="7.33000000"/>
        <inertia ixx="0.02513174" ixy="0.00012221" ixz="-0.00333856" iyy="0.03765338" iyz="-0.00009292" izz="0.02694824"/>
      </inertial>
    </link>

    <link name="${prefix}link_4">
      <visual>
        <geometry>
          <mesh filename="package://za_description/meshes/visual/link_4.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://za_description/meshes/collision/link_4_collision.stl"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="0.30544152 0.00346903 0.00392327"/>
        <mass value="6.11000000"/>
        <inertia ixx="0.01559502" ixy="-0.00031903" ixz="0.00008767" iyy="0.05602555" iyz="-0.00001324" izz="0.06119102"/>
      </inertial>
    </link>

    <link name="${prefix}link_5">
      <visual>
        <geometry>
          <mesh filename="package://za_description/meshes/visual/link_5.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://za_description/meshes/collision/link_5_collision.stl"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="-0.00517740 0.00016151 0.00015567"/>
        <mass value="2.44000000"/>
        <inertia ixx="0.00267434" ixy="0.00000003" ixz="-0.00000009" iyy="0.00582935" iyz="-0.00000003" izz="0.00571470"/>
      </inertial>
    </link>

    <link name="${prefix}link_6">
      <visual>
        <geometry>
          <mesh filename="package://za_description/meshes/visual/link_6.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://za_description/meshes/collision/link_6_collision.stl"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="-0.00968719 -0.00009104 0.00002796"/>
        <mass value="0.24400000"/>
        <inertia ixx="0.00010069" ixy="0.00000000" ixz="0.00000000" iyy="0.00006352" iyz="0.00000000" izz="0.00006352"/>
      </inertial>
    </link>

    <!-- joint list -->
    <joint name="${prefix}joint_1" type="revolute">
      <origin rpy="0.0 0.0 0.0" xyz="0 0 0.45"/>
      <axis xyz="0 0 1"/>
      <parent link="${prefix}base_link"/>
      <child link="${prefix}link_1"/>
      <limit effort="1000.0" lower="-2.96" upper="2.96" velocity="2.6"/>
      <dynamics damping="0.003" friction="0.0" mu_coulomb="0" mu_viscous="16" />
    </joint>
    <joint name="${prefix}joint_2" type="revolute">
      <origin rpy="0.0 0.0 0.0" xyz="0.025 0 0.0"/>
      <axis xyz="0 1 0"/>
      <parent link="${prefix}link_1"/>
      <child link="${prefix}link_2"/>
      <limit effort="1000.0" lower="-1.74" upper="2.35" velocity="1.9"/>
      <dynamics damping="0.003" friction="0.0" mu_coulomb="0" mu_viscous="16" />
    </joint>
    <joint name="${prefix}joint_3" type="revolute">
      <origin rpy="0.0 0.0 0.0" xyz="0.0 -0.001 0.454"/>
      <axis xyz="0 1 0"/>
      <parent link="${prefix}link_2"/>
      <child link="${prefix}link_3"/>
      <limit effort="1000.0" lower="-1.570796" upper="1.15" velocity="2.6"/>
      <dynamics damping="0.003" friction="0.0" mu_coulomb="0" mu_viscous="16" />
    </joint>
    <joint name="${prefix}joint_4" type="revolute">
      <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.035"/>
      <axis xyz="1 0 0"/>
      <parent link="${prefix}link_3"/>
      <child link="${prefix}link_4"/>
      <limit effort="1000.0" lower="-2.6" upper="2.6" velocity="3.5"/>
      <dynamics damping="0.003" friction="0.0" mu_coulomb="0" mu_viscous="16" />
    </joint>
    <joint name="${prefix}joint_5" type="revolute">
      <origin rpy="0.0 0.0 0.0" xyz="0.4195 0.001 0.0"/>
      <axis xyz="0 1 0"/>
      <parent link="${prefix}link_4"/>
      <child link="${prefix}link_5"/>
      <limit effort="1000.0" lower="-2.49" upper="2.49" velocity="3.9"/>
      <dynamics damping="0.003" friction="0.0" mu_coulomb="0" mu_viscous="16" />
    </joint>
    <joint name="${prefix}joint_6" type="revolute">
      <origin rpy="0.0 0.0 0.0" xyz="0.1175 0.0 0.0"/>
      <axis xyz="1 0 0"/>
      <parent link="${prefix}link_5"/>
      <child link="${prefix}link_6"/>
      <limit effort="1000.0" lower="${pi*-1}" upper="${pi*1}" velocity="${pi*2}"/>
      <dynamics damping="0.003" friction="0.0" mu_coulomb="0" mu_viscous="16" />
    </joint>

    <!-- ROS-Industrial 'base' frame: base_link to Fanuc World Coordinates transform -->
    <link name="${prefix}base" />
    <joint name="${prefix}base_link-base" type="fixed">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
      <parent link="${prefix}base_link"/>
      <child link="${prefix}base"/>
    </joint>

    <!-- ROS-Industrial 'flange' frame: attachment point for EEF models -->
    <link name="${prefix}flange" />
    <joint name="${prefix}joint_6-flange" type="fixed">
      <origin xyz="0 0 0" rpy="0 0 0" />
      <parent link="${prefix}link_6" />
      <child link="${prefix}flange" />
    </joint>

    <!-- ROS-Industrial 'tool0' frame: all-zeros tool frame -->
    <link name="${prefix}tool0" />
    <joint name="${prefix}link_6_tool0" type="fixed">
      <origin xyz="0 0 0" rpy="0 ${pi/2} 0" />
      <parent link="${prefix}flange" />
      <child link="${prefix}tool0" />
    </joint>

    <!-- Define additional Gazebo tags -->
    <xacro:if value="$(arg gazebo)">
      <xacro:gazebo-joint joint="${prefix}joint_1" transmission="hardware_interface/EffortJointInterface" />
      <xacro:gazebo-joint joint="${prefix}joint_2" transmission="hardware_interface/EffortJointInterface" />
      <xacro:gazebo-joint joint="${prefix}joint_3" transmission="hardware_interface/EffortJointInterface" />
      <xacro:gazebo-joint joint="${prefix}joint_4" transmission="hardware_interface/EffortJointInterface" />
      <xacro:gazebo-joint joint="${prefix}joint_5" transmission="hardware_interface/EffortJointInterface" />
      <xacro:gazebo-joint joint="${prefix}joint_6" transmission="hardware_interface/EffortJointInterface" />

      <xacro:gazebo-joint joint="${prefix}joint_1" transmission="hardware_interface/VelocityJointInterface" />
      <xacro:gazebo-joint joint="${prefix}joint_2" transmission="hardware_interface/VelocityJointInterface" />
      <xacro:gazebo-joint joint="${prefix}joint_3" transmission="hardware_interface/VelocityJointInterface" />
      <xacro:gazebo-joint joint="${prefix}joint_4" transmission="hardware_interface/VelocityJointInterface" />
      <xacro:gazebo-joint joint="${prefix}joint_5" transmission="hardware_interface/VelocityJointInterface" />
      <xacro:gazebo-joint joint="${prefix}joint_6" transmission="hardware_interface/VelocityJointInterface" />

      <xacro:gazebo-joint joint="${prefix}joint_1" transmission="hardware_interface/PositionJointInterface" />
      <xacro:gazebo-joint joint="${prefix}joint_2" transmission="hardware_interface/PositionJointInterface" />
      <xacro:gazebo-joint joint="${prefix}joint_3" transmission="hardware_interface/PositionJointInterface" />
      <xacro:gazebo-joint joint="${prefix}joint_4" transmission="hardware_interface/PositionJointInterface" />
      <xacro:gazebo-joint joint="${prefix}joint_5" transmission="hardware_interface/PositionJointInterface" />
      <xacro:gazebo-joint joint="${prefix}joint_6" transmission="hardware_interface/PositionJointInterface" />

      <xacro:transmission-za-state arm_id="${prefix}" />
      <xacro:transmission-za-model arm_id="${prefix}"
         root="${prefix}joint_1"
         tip="${prefix}joint_6-flange"
      />
    </xacro:if>
  </xacro:macro>
</robot>
